<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>圣经地理互动地图</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" >
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600&amp;family=Quicksand:wght@400;500;600&amp;display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #161665;
            --accent-color: #A3A387;
            --neutral-color: #C544F8;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Work Sans', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .title {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0;
        }

        .language-switch {
            display: flex;
            gap: 0.5rem;
        }

        .lang-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--accent-color);
            background: transparent;
            color: var(--accent-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            font-weight: 500;
        }

        .lang-btn.active,
        .lang-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        .map-container {
            flex: 0 0 60%;
            height: 100vh;
            position: relative;
            padding-top: 80px;
        }

        #map {
            width: 100%;
            height: calc(100% - 80px);
            border-radius: 0;
        }

        .sidebar {
            flex: 0 0 40%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            overflow-y: auto;
            border-left: 1px solid var(--border-color);
            box-shadow: -5px 0 15px var(--shadow-color);
            padding-top: 100px;
        }

        .sidebar-content {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .location-title {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            border-bottom: 3px solid var(--accent-color);
            padding-bottom: 0.5rem;
        }

        .location-subtitle {
            font-size: 1.2rem;
            color: var(--accent-color);
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .info-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(248, 250, 252, 0.6);
            border-radius: 12px;
            border-left: 4px solid var(--accent-color);
        }

        .info-section h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .info-section p {
            line-height: 1.6;
            margin-bottom: 0.8rem;
        }

        .coordinates {
            font-family: 'Courier New', monospace;
            background: var(--bg-color);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            display: inline-block;
            font-size: 0.9rem;
        }

        .bible-verse {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            font-style: italic;
            position: relative;
            overflow: hidden;
        }

        .bible-verse::before {
            content: '"';
            font-size: 4rem;
            position: absolute;
            top: -0.5rem;
            left: 1rem;
            opacity: 0.3;
            font-family: Georgia, serif;
        }

        .route-controls {
            position: absolute;
            top: 100px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow-color);
            backdrop-filter: blur(10px);
        }

        .route-btn {
            display: block;
            width: 100%;
            padding: 0.8rem 1.2rem;
            margin: 0.5rem 0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: left;
        }

        .route-btn.moses {
            background: linear-gradient(135deg, #8B4513, #CD853F);
            color: white;
        }

        .route-btn.jesus {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #8B4513;
        }

        .route-btn.paul {
            background: linear-gradient(135deg, #4169E1, #6495ED);
            color: white;
        }

        .route-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow-color);
        }

        .route-btn.active {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow-color);
        }

        .welcome-message {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--accent-color);
        }

        .welcome-message h2 {
            font-family: 'Quicksand', sans-serif;
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .welcome-message p {
            font-size: 1.1rem;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .map-container {
                flex: none;
                height: 50vh;
                padding-top: 70px;
            }
            
            #map {
                height: calc(100% - 70px);
            }
            
            .sidebar {
                flex: none;
                height: 50vh;
                border-left: none;
                border-top: 1px solid var(--border-color);
                padding-top: 1.5rem;
            }
            
            .header {
                padding: 0.8rem 1rem;
            }
            
            .title {
                font-size: 1.2rem;
            }
            
            .route-controls {
                position: relative;
                top: auto;
                left: auto;
                margin: 1rem;
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .route-btn {
                flex: 1;
                min-width: 120px;
                margin: 0;
            }
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.2rem;
            color: var(--accent-color);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .leaflet-popup-content {
            font-family: 'Work Sans', sans-serif;
            font-size: 14px;
            line-height: 1.4;
        }

        .custom-popup {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 4px 20px var(--shadow-color);
        }

        .custom-popup h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-family: 'Quicksand', sans-serif;
        }

        .custom-popup p {
            color: var(--text-color);
            margin-bottom: 0.3rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">圣经地理互动地图</h1>
            <div class="language-switch">
                <button class="lang-btn active" data-lang="zh">中文</button>
                <button class="lang-btn" data-lang="en">English</button>
            </div>
        </header>

        <div class="map-container">
            <div class="route-controls">
                <button class="route-btn moses" data-route="moses">
                    <strong>摩西出埃及</strong><br>
                    <small>埃及 → 红海 → 西奈山 → 迦南</small>
                </button>
                <button class="route-btn jesus" data-route="jesus">
                    <strong>耶稣传道</strong><br>
                    <small>拿撒勒 → 加利利 → 耶路撒冷</small>
                </button>
                <button class="route-btn paul" data-route="paul">
                    <strong>保罗传道</strong><br>
                    <small>耶路撒冷 → 小亚细亚 → 希腊 → 罗马</small>
                </button>
            </div>
            <div id="map"></div>
        </div>

        <div class="sidebar">
            <div class="sidebar-content" id="sidebar-content">
                <div class="welcome-message">
                    <h2>欢迎来到圣经地理互动地图</h2>
                    <p>点击地图上的地点标记，了解圣经中的重要地理位置和相关故事。使用左侧的路线按钮，可以查看摩西、耶稣和保罗的行走轨迹。</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script type="module">
        // Bible locations data
        const bibleLocations = {
            zh: {
                jerusalem: {
                    name: "耶路撒冷",
                    subtitle: "Jerusalem - 三大宗教圣地",
                    lat: 31.7683,
                    lng: 35.2137,
                    description: "耶路撒冷是犹太教、基督教和伊斯兰教的圣地，被称为'圣城'。",
                    significance: "这里是耶稣受难、复活和升天的地点，也是所罗门王建造第一圣殿的地方。",
                    verses: "诗篇122:6 - '你们要为耶路撒冷求平安。耶路撒冷啊，爱你的人必然兴旺。'",
                    events: [
                        "耶稣在此受难、复活、升天",
                        "所罗门建造第一圣殿",
                        "耶稣在此教导和行神迹"
                    ]
                },
                bethlehem: {
                    name: "伯利恒",
                    subtitle: "Bethlehem - 耶稣诞生地",
                    lat: 31.7054,
                    lng: 35.2024,
                    description: "伯利恒是大卫王的故乡，也是耶稣基督的诞生地。",
                    significance: "这里是弥赛亚诞生的地方，实现了旧约圣经的预言。",
                    verses: "马太福音2:1 - '当希律王的时候，耶稣生在犹太的伯利恒。'",
                    events: [
                        "耶稣基督诞生",
                        "博士来朝拜",
                        "大卫王出生"
                    ]
                },
                nazareth: {
                    name: "拿撒勒",
                    subtitle: "Nazareth - 耶稣成长地",
                    lat: 32.7035,
                    lng: 35.2959,
                    description: "拿撒勒是耶稣度过童年和青年时期的地方。",
                    significance: "耶稣被称为'拿撒勒人'，在这里成长并学会木匠手艺。",
                    verses: "马太福音2:23 - '到了一座城，名叫拿撒勒，就住在那里。'",
                    events: [
                        "耶稣在此成长",
                        "约瑟和马利亚居住于此",
                        "耶稣开始公开传道"
                    ]
                },
                galilee: {
                    name: "加利利海",
                    subtitle: "Sea of Galilee - 耶稣传道区域",
                    lat: 32.8333,
                    lng: 35.5833,
                    description: "加利利海是耶稣大部分神迹和教导发生的地方。",
                    significance: "这里是耶稣呼召门徒、行神迹和教导的重要场所。",
                    verses: "马太福音4:18 - '耶稣在加利利海边行走，看见弟兄二人。'",
                    events: [
                        "耶稣行走在水面上",
                        "五饼二鱼的神迹",
                        "呼召彼得等门徒"
                    ]
                },
                jordan: {
                    name: "约旦河",
                    subtitle: "Jordan River - 施洗约翰施洗处",
                    lat: 31.8333,
                    lng: 35.5833,
                    description: "约旦河是以色列人进入应许之地和耶稣受洗的地方。",
                    significance: "施洗约翰在此为人施洗，耶稣也在这里接受洗礼。",
                    verses: "马太福音3:13 - '当下，耶稣从加利利来到约旦河，见了约翰，要受他的洗。'",
                    events: [
                        "耶稣接受洗礼",
                        "施洗约翰传道",
                        "以色列人过约旦河"
                    ]
                },
                sinai: {
                    name: "西奈山",
                    subtitle: "Mount Sinai - 摩西接受十诫",
                    lat: 28.5392,
                    lng: 33.9753,
                    description: "西奈山是摩西接受十诫和律法的地方。",
                    significance: "这里是神与摩西相遇，颁布十诫和律法的神圣之地。",
                    verses: "出埃及记19:20 - '耶和华降临在西奈山顶上，耶和华召摩西上山顶。'",
                    events: [
                        "摩西接受十诫",
                        "神颁布律法",
                        "以色列人安营"
                    ]
                },
                redsea: {
                    name: "红海",
                    subtitle: "Red Sea - 摩西分红海",
                    lat: 27.5,
                    lng: 34.8,
                    description: "红海是摩西带领以色列人出埃及时神迹分开海水的地方。",
                    significance: "神在这里施行大神迹，分开红海让以色列人安全通过。",
                    verses: "出埃及记14:21 - '摩西向海伸杖，耶和华便用大东风，使海水一夜退去。'",
                    events: [
                        "红海分开神迹",
                        "以色列人安全通过",
                        "法老军队被淹没"
                    ]
                },
                jericho: {
                    name: "耶利哥",
                    subtitle: "Jericho - 古城墙倒塌",
                    lat: 31.8704,
                    lng: 35.4437,
                    description: "耶利哥是以色列人进入迦南地时攻下的第一座城市。",
                    significance: "这里的城墙因以色列人的信心和神的干预而倒塌。",
                    verses: "约书亚记6:20 - '百姓便呼喊，祭司也吹角。百姓听见角声，便大声呼喊，城墙就塌陷。'",
                    events: [
                        "城墙倒塌神迹",
                        "喇合得救",
                        "以色列人进入迦南"
                    ]
                },
                caesarea: {
                    name: "该撒利亚",
                    subtitle: "Caesarea - 罗马行政中心",
                    lat: 32.5027,
                    lng: 34.9055,
                    description: "该撒利亚是罗马统治时期的行政中心，位于地中海沿岸。",
                    significance: "这里是保罗被囚和受审的地方，也是早期教会的重要中心。",
                    verses: "使徒行传10:1 - '在该撒利亚有一个人，名叫哥尼流，是意大利营的百夫长。'",
                    events: [
                        "哥尼流归主",
                        "保罗被囚",
                        "早期教会中心"
                    ]
                },
                samaria: {
                    name: "撒马利亚",
                    subtitle: "Samaria - 撒马利亚人区域",
                    lat: 32.0569,
                    lng: 35.2897,
                    description: "撒马利亚是北国以色列的首都，撒马利亚人的居住地。",
                    significance: "耶稣在此与撒马利亚妇人对话，展现了神的普世救恩。",
                    verses: "约翰福音4:4 - '必须经过撒马利亚。'",
                    events: [
                        "耶稣与撒马利亚妇人对话",
                        "好撒马利亚人比喻",
                        "早期福音传播"
                    ]
                }
            },
            en: {
                jerusalem: {
                    name: "Jerusalem",
                    subtitle: "Jerusalem - Holy City of Three Religions",
                    lat: 31.7683,
                    lng: 35.2137,
                    description: "Jerusalem is a holy city for Judaism, Christianity, and Islam.",
                    significance: "This is where Jesus was crucified, resurrected, and ascended to heaven.",
                    verses: "Psalm 122:6 - 'Pray for the peace of Jerusalem: they shall prosper that love thee.'",
                    events: [
                        "Jesus was crucified, resurrected, and ascended here",
                        "Solomon built the First Temple",
                        "Jesus taught and performed miracles here"
                    ]
                },
                bethlehem: {
                    name: "Bethlehem",
                    subtitle: "Bethlehem - Birthplace of Jesus",
                    lat: 31.7054,
                    lng: 35.2024,
                    description: "Bethlehem is the birthplace of King David and Jesus Christ.",
                    significance: "This is where the Messiah was born, fulfilling Old Testament prophecy.",
                    verses: "Matthew 2:1 - 'Now when Jesus was born in Bethlehem of Judaea...'",
                    events: [
                        "Jesus Christ was born",
                        "The Magi came to worship",
                        "King David was born"
                    ]
                },
                nazareth: {
                    name: "Nazareth",
                    subtitle: "Nazareth - Where Jesus Grew Up",
                    lat: 32.7035,
                    lng: 35.2959,
                    description: "Nazareth is where Jesus spent his childhood and youth.",
                    significance: "Jesus was called 'the Nazarene' and grew up here, learning carpentry.",
                    verses: "Matthew 2:23 - 'And he came and dwelt in a city called Nazareth...'",
                    events: [
                        "Jesus grew up here",
                        "Joseph and Mary lived here",
                        "Jesus began his public ministry"
                    ]
                },
                galilee: {
                    name: "Sea of Galilee",
                    subtitle: "Sea of Galilee - Jesus' Ministry Area",
                    lat: 32.8333,
                    lng: 35.5833,
                    description: "The Sea of Galilee is where most of Jesus' miracles and teachings occurred.",
                    significance: "This is where Jesus called disciples, performed miracles, and taught.",
                    verses: "Matthew 4:18 - 'And Jesus, walking by the sea of Galilee, saw two brethren...'",
                    events: [
                        "Jesus walked on water",
                        "The feeding of the 5000",
                        "Called Peter and other disciples"
                    ]
                },
                jordan: {
                    name: "Jordan River",
                    subtitle: "Jordan River - John the Baptist's Baptism Site",
                    lat: 31.8333,
                    lng: 35.5833,
                    description: "The Jordan River is where the Israelites entered the Promised Land and Jesus was baptized.",
                    significance: "John the Baptist baptized people here, including Jesus.",
                    verses: "Matthew 3:13 - 'Then cometh Jesus from Galilee to Jordan unto John, to be baptized of him.'",
                    events: [
                        "Jesus was baptized",
                        "John the Baptist preached",
                        "Israelites crossed the Jordan"
                    ]
                },
                sinai: {
                    name: "Mount Sinai",
                    subtitle: "Mount Sinai - Moses Received the Ten Commandments",
                    lat: 28.5392,
                    lng: 33.9753,
                    description: "Mount Sinai is where Moses received the Ten Commandments and the Law.",
                    significance: "This is where God met Moses and gave the Ten Commandments and the Law.",
                    verses: "Exodus 19:20 - 'And the Lord came down upon mount Sinai, on the top of the mount...'",
                    events: [
                        "Moses received the Ten Commandments",
                        "God gave the Law",
                        "Israelites camped here"
                    ]
                },
                redsea: {
                    name: "Red Sea",
                    subtitle: "Red Sea - Moses Parted the Waters",
                    lat: 27.5,
                    lng: 34.8,
                    description: "The Red Sea is where Moses led the Israelites out of Egypt through a miraculous parting.",
                    significance: "God performed a great miracle here, parting the sea for Israel's safe passage.",
                    verses: "Exodus 14:21 - 'And Moses stretched out his hand over the sea; and the Lord caused the sea to go back...'",
                    events: [
                        "The parting of the Red Sea",
                        "Israelites passed safely",
                        "Pharaoh's army was drowned"
                    ]
                },
                jericho: {
                    name: "Jericho",
                    subtitle: "Jericho - Ancient Walls Fell",
                    lat: 31.8704,
                    lng: 35.4437,
                    description: "Jericho was the first city the Israelites conquered when entering Canaan.",
                    significance: "The walls here fell through Israel's faith and God's intervention.",
                    verses: "Joshua 6:20 - '...the people shouted with a great shout, that the wall fell down flat...'",
                    events: [
                        "The walls fell miraculously",
                        "Rahab was saved",
                        "Israelites entered Canaan"
                    ]
                },
                caesarea: {
                    name: "Caesarea",
                    subtitle: "Caesarea - Roman Administrative Center",
                    lat: 32.5027,
                    lng: 34.9055,
                    description: "Caesarea was the administrative center during Roman rule, located on the Mediterranean coast.",
                    significance: "This is where Paul was imprisoned and tried, and an important early church center.",
                    verses: "Acts 10:1 - 'There was a certain man in Caesarea called Cornelius, a centurion of the Italian band...'",
                    events: [
                        "Cornelius was converted",
                        "Paul was imprisoned",
                        "Early church center"
                    ]
                },
                samaria: {
                    name: "Samaria",
                    subtitle: "Samaria - Samaritan Region",
                    lat: 32.0569,
                    lng: 35.2897,
                    description: "Samaria was the capital of the northern kingdom of Israel and home of the Samaritans.",
                    significance: "Jesus spoke with the Samaritan woman here, showing God's universal salvation.",
                    verses: "John 4:4 - 'And he must needs go through Samaria.'",
                    events: [
                        "Jesus spoke with the Samaritan woman",
                        "The Good Samaritan parable",
                        "Early gospel spread"
                    ]
                }
            }
        };

        // Route data
        const routes = {
            moses: {
                zh: { name: "摩西出埃及路线", description: "从埃及到应许之地的旅程" },
                en: { name: "Moses' Exodus Route", description: "Journey from Egypt to the Promised Land" },
                color: "#8B4513",
                coordinates: [
                    [30.0, 31.2], // Egypt
                    [27.5, 34.8], // Red Sea
                    [28.5392, 33.9753], // Mount Sinai
                    [31.0, 35.0], // Wilderness
                    [31.7683, 35.2137] // Canaan/Jerusalem
                ]
            },
            jesus: {
                zh: { name: "耶稣传道路线", description: "从拿撒勒到耶路撒冷的教导之旅" },
                en: { name: "Jesus' Ministry Route", description: "Teaching journey from Nazareth to Jerusalem" },
                color: "#FFD700",
                coordinates: [
                    [32.7035, 35.2959], // Nazareth
                    [32.85, 35.5], // Cana
                    [32.88, 35.57], // Capernaum
                    [32.8333, 35.5833], // Sea of Galilee
                    [31.7683, 35.2137] // Jerusalem
                ]
            },
            paul: {
                zh: { name: "保罗传道旅程", description: "从耶路撒冷到罗马的传播福音之旅" },
                en: { name: "Paul's Missionary Journey", description: "Gospel-spreading journey from Jerusalem to Rome" },
                color: "#4169E1",
                coordinates: [
                    [31.7683, 35.2137], // Jerusalem
                    [36.2, 36.15], // Antioch
                    [39.9, 32.8], // Asia Minor
                    [37.9, 23.7], // Greece
                    [41.9, 12.5] // Rome
                ]
            }
        };

        let map;
        let markers = {};
        let currentRoute = null;
        let currentLang = 'zh';

        // Initialize map
        function initMap() {
            map = L.map('map').setView([31.5, 35.5], 8);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            addMarkers();
            setupEventListeners();
        }

        // Add markers for all locations
        function addMarkers() {
            const data = bibleLocations[currentLang];
            
            Object.keys(data).forEach(key => {
                const location = data[key];
                
                const marker = L.marker([location.lat, location.lng])
                    .addTo(map)
                    .bindPopup(`
                        <div class="custom-popup">
                            <h3>${location.name}</h3>
                            <p><strong>${location.subtitle}</strong></p>
                            <p>${location.description}</p>
                        </div>
                    `);
                
                marker.on('click', () => showLocationDetails(key));
                markers[key] = marker;
            });
        }

        // Show location details in sidebar
        function showLocationDetails(locationKey) {
            const location = bibleLocations[currentLang][locationKey];
            const sidebar = document.getElementById('sidebar-content');
            
            sidebar.innerHTML = `
                <div class="sidebar-content">
                    <h2 class="location-title">${location.name}</h2>
                    <p class="location-subtitle">${location.subtitle}</p>
                    
                    <div class="info-section">
                        <h3>地理坐标</h3>
                        <p class="coordinates">${location.lat.toFixed(4)}°, ${location.lng.toFixed(4)}°</p>
                    </div>
                    
                    <div class="info-section">
                        <h3>圣经意义</h3>
                        <p>${location.significance}</p>
                    </div>
                    
                    <div class="info-section">
                        <h3>相关事件</h3>
                        ${location.events.map(event => `<p>• ${event}</p>`).join('')}
                    </div>
                    
                    <div class="bible-verse">
                        <h3>相关经文</h3>
                        <p>${location.verses}</p>
                    </div>
                </div>
            `;
        }

        // Draw route on map
        function drawRoute(routeKey) {
            if (currentRoute) {
                map.removeLayer(currentRoute);
            }
            
            const route = routes[routeKey];
            const data = route[currentLang];
            
            const polyline = L.polyline(route.coordinates, {
                color: route.color,
                weight: 4,
                opacity: 0.8
            }).addTo(map);
            
            polyline.bindPopup(`
                <div class="custom-popup">
                    <h3>${data.name}</h3>
                    <p>${data.description}</p>
                </div>
            `);
            
            currentRoute = polyline;
            map.fitBounds(polyline.getBounds(), { padding: [20, 20] });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Language switch
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentLang = e.target.dataset.lang;
                    updateContent();
                });
            });

            // Route buttons
            document.querySelectorAll('.route-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.route-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    const routeKey = e.target.dataset.route;
                    drawRoute(routeKey);
                });
            });
        }

        // Update content based on language
        function updateContent() {
            // Update title
            document.querySelector('.title').textContent = 
                currentLang === 'zh' ? '圣经地理互动地图' : 'Interactive Bible Geography Map';
            
            // Update welcome message
            const welcomeMsg = bibleLocations[currentLang].welcome || {
                zh: {
                    title: '欢迎来到圣经地理互动地图',
                    content: '点击地图上的地点标记，了解圣经中的重要地理位置和相关故事。使用左侧的路线按钮，可以查看摩西、耶稣和保罗的行走轨迹。'
                },
                en: {
                    title: 'Welcome to Interactive Bible Geography Map',
                    content: 'Click on location markers on the map to learn about important biblical places and their stories. Use the route buttons on the left to view the journeys of Moses, Jesus, and Paul.'
                }
            }[currentLang];
            
            document.querySelector('.welcome-message h2').textContent = welcomeMsg.title;
            document.querySelector('.welcome-message p').textContent = welcomeMsg.content;
            
            // Update route buttons
            Object.keys(routes).forEach(routeKey => {
                const btn = document.querySelector(`[data-route="${routeKey}"]`);
                const route = routes[routeKey][currentLang];
                btn.innerHTML = `
                    <strong>${route.name}</strong><br>
                    <small>${route.description}</small>
                `;
            });
            
            // Clear current route
            if (currentRoute) {
                map.removeLayer(currentRoute);
                currentRoute = null;
            }
            
            // Update sidebar to welcome message
            const sidebar = document.getElementById('sidebar-content');
            sidebar.innerHTML = `
                <div class="sidebar-content">
                    <div class="welcome-message">
                        <h2>${welcomeMsg.title}</h2>
                        <p>${welcomeMsg.content}</p>
                    </div>
                </div>
            `;
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>